machine:
  php:
    version: 7.0.4

checkout:
  post:
    - git submodule sync
    - git submodule update --init
    - ln -s /home/ubuntu/vae_remote/tests/dependencies/vae_thrift /home/ubuntu/vae_thrift

dependencies:
  pre:
    - sudo apt-get update; sudo apt-get install libantlr3c-dev libzmq-dev libpcre3-dev libthrift-dev libmemcached-dev libmysqlcppconn-dev
    - sudo git clone https://github.com/bji/libs3.git && cd libs3 && sudo make install
    - cd tests/dependencies/vaeql && make && make install
    - cd tests/dependencies/vae_thrift/cpp && ./configure && make && make install
    - echo "extension=vaeql.so" > ~/.phpenv/versions/$(phpenv global)/etc/conf.d/vaeql.ini

test:
  override:
    - php tests/_all.php
